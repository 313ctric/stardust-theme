{% extends "section.html" %}
{% import "macros/events.html" as events %}

{% block head %}
{{ super() }}
<link rel="stylesheet" href="{{ config.base_url | safe }}/icon-packs/phosphor-bold.css">
{% endblock %}


{% block get_pages %}
  {{ super() }}
  {% set pages = pages | sort(attribute="date") %}
{% endblock %}


{% block pages %}
{{ resource.content | safe}}

{% set prev_day = "" %}
{% set days_events = [] %}

<div class="term blue w-100 vstack align-items-center p-3 gap-4">
<div class="week w-100 text-center">
  <div class="events d-grid justify-content-center">

    {% for e in pages %}
      {% if e.extra.display_day %}{% set e_day = e.extra.display_day %}
      {% else %}{% set e_day = e.date | date(format="%A") %}{% endif %}
      {% if e_day != prev_day %}
        {# Output previous day's content #}
        {% if days_events %}
          {{ events::day(events=days_events) }}
          {% set_global days_events = [] %}
          {% set_global started = true %}
        {% endif %}
        {% set_global prev_day = e_day %}
      {% endif %}
      {% set_global days_events = days_events | concat(with=e) %}
    {% endfor %}

    {% if started %}
      {% if days_events %}
        {{ events::day(events=days_events) }}
      {% endif %}
    {% endif %}

{{ events::end_week() }}
{{ events::end_term() }}

{% block script %}
  {{ events::script() }}
{% endblock %}

{% endblock %}