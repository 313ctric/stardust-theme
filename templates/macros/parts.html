{% import "macros/logos.html" as logos %}
{% import "macros/formatters.html" as formatters %}

{% macro preview_styles() %}

CMS.registerPreviewStyle("https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700");
CMS.registerPreviewStyle("https://fonts.googleapis.com/css2?family=Mulish:wght@400;500;600;700");
CMS.registerPreviewStyle("{{ config.base_url | safe }}/icon-packs/bootstrap-icons.min.css");
CMS.registerPreviewStyle("{{ config.base_url | safe }}/style.css");

{% endmacro preview_styles %}

{% macro head() %}
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link rel="icon" type="image/x-icon" href="{{ config.base_url | safe }}/assets/favicon.png">
<link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Mulish:wght@400;500;600;700" rel="stylesheet">
<link rel="stylesheet" href="{{ config.base_url | safe }}/uwcs-bootstrap.css">
<script src="{{ config.base_url | safe }}/scripts/bootstrap.bundle.min.js"></script>
<link rel="stylesheet" href="{{ config.base_url | safe }}/icon-packs/bootstrap-icons.min.css">
<link rel="stylesheet" href="{{ config.base_url | safe }}/icon-packs/phosphor-bold.css">
<script src="{{ config.base_url | safe }}/scripts/darkmode.js"></script>

{% if config.markdown.highlight_code and config.markdown.highlight_theme == "css" %}
<link rel="stylesheet" type="text/css" href="/syntax-theme-dark.css" />
<link rel="stylesheet" type="text/css" href="/syntax-theme-light.css" />
{% endif %}
{% endmacro head %}

{% macro opengraph(resource) %}

{# Open Graph #}
<meta property="og:title"
  content="{%- if resource.title -%} {{ resource.title }} {%- else -%} {{ resource.name }} {%- endif -%}" />
{% set description = "" %}
{% if resource.summary %}
{% set description = resource.summary | striptags %}
{% elif current_path == "/" %}
{% set description = "UWCS is free-to-join, and open to anyone with an interest in the field of Computer Science. We
have ties to the CS department - hosting weekly academic, social and gaming events." %}
{% elif resource.content %}
{% set description = resource.content | split(pat="</p>") | first | split(pat="<p>") | last | striptags | safe %}
  {% endif %}
  {% if resource.date %}
  {% set date = formatters::event_date_range(e=resource) %}
  {% set description = description ~ " " ~ date ~ ". " %}
  {% endif %}
  {% if resource.extra.location %}
  {% set description = description ~ resource.extra.location %}
  {% endif %}
  <meta name="description" content="{{ description }}" />
  <meta property="og:description" content="{{ description }}" />
  <meta property="og:url" content="{{current_url | safe }}" />
  <meta property="og:image" content="{{ get_url(path=" bg-16-9.png")}}" />
  <meta property="og:locale" content="en_GB" />
  <meta name="keywords" content="UWCS, Computing, University, Computer Science, Warwick, University of Warwick Computing Society, Programming, Gaming, Coding 
{%- if resource.taxonomies -%}
  {%- for _,terms in resource.taxonomies -%}
    {%- for term in terms -%}
      , {{ term }}
    {%- endfor -%}
  {%- endfor -%}
{%- endif -%}">

  {% endmacro %}



  {% macro nav() %}
<nav id="nav" class="navbar navbar-expand-lg" {% if config.base_url is containing('draft')
  %}style="border-color: var(--bs-danger) !important" {% endif %}>
  <div class="container-lg align-items-center">

    <!-- UWCS Logo -->
    <a class="navbar-brand" href="{{ config.base_url | safe }}">
      {{ logos::dots_uwcs() }}
    </a>

    <!-- Navbar parts for mobile version -->
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarColor03"
      aria-controls="navbarColor03" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarColor03">
      <ul class="navbar-nav d-flex w-100">

        <!-- Include links to top level sections -->
        {% set sect = get_section(path='_index.md') %}
        {% for sub in sect.subsections %}
        {% set subsect = get_section(path=sub) %}
        {% if subsect.extra.hide %}{% continue %}{% endif %}
        <li><a class="nav-link" href="{{ subsect.permalink | safe }}">{{ subsect.title }}</a></li>
        {% endfor %}

        <li class="ms-lg-auto me-lg-2 nav-item dropdown">
          <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
            Other Links
          </a>
          <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
            <li><a target="_blank" rel="noopener" class="dropdown-item" href="https://techteam.uwcs.co.uk">Tech Team
                Wiki</a></li>
            <li><a target="_blank" rel="noopener" class="dropdown-item" href="https://progcomp.uwcs.co.uk/">Programming
                Competitions</a></li>
            <li><a target="_blank" rel="noopener" class="dropdown-item" href="https://warwickspeed.run">WASD (Warwick
                Speedrun)</a></li>
            <li><a target="_blank" rel="noopener" class="dropdown-item" href="https://github.com/UWCS">Our GitHub</a>
            </li>
          </ul>
        </li>

        <!-- Dark mode toggles -->
        <div class="vr d-none d-lg-block "></div>
        <li class="nav-item ms-lg-2">
          <a id="dark-mode" class="nav-link ml-1" href="#">

            {{ shortcodes::icon(icon="ph-moon") }}
            <span class="d-lg-none ms-2 ms-lg-0">Toggle Dark Mode</span>
          </a>
        </li>
      </ul>
    </div>
  </div>
</nav>
{% endmacro nav %}



{% macro bbreadcrumb() %}
<!-- Hacky way for this to work on sections and pages -->
{% if section %}
{% set page = section %}
{% endif %}

<!-- Don't trigger on top level -->
{% if page.ancestors | length > 1 %}
<nav aria-label="breadcrumb" class="container-lg pt-2 bg-body px-4">
  <ol class="breadcrumb">
    <!-- Generate for each ancestor -->
    {% for parent in page.ancestors %}
    {% if not loop.first %} <!-- Ignore first -->
    {% set s = get_section(path=parent, include_pages=false) %}
    <li class="breadcrumb-item"><a href="{{ s.permalink | safe }}">{{ s.title | truncate(length=25) }}</a></li>
    {% endif %}
    {% endfor %}
    <!-- Include actual page -->
    <li class="breadcrumb-item active" aria-current="page">{{ page.title | truncate(length=25)}}</li>
  </ol>
</nav>
{% endif %}
{% endmacro bbreadcrumb %}


{% macro footer() %}
<footer id="foot">
  <!-- Centred aligned uwcs logo -->
  <a class="d-flex text-decoration-none" href="https://uwcs.co.uk">
    {{ logos::dots_uwcs() }}
  </a>
  <!-- Right aligned links -->
  <ul class="nav justify-content-end list-unstyled d-flex align-items-center">
    {% set socs = get_section(path="socials/_index.md") %}
    {% for social in socs.pages %}
    <li class="fs-4 ms-3 d-block {% if social.extra.img %}opacity-50{% endif %}">
      <a target="_blank" rel="noopener" class="d-flex text-muted opacity-hover" href="{{ social.extra.link }}">
        {% if social.extra.img %}{% set icon = social.extra.img %}
        {% elif social.extra.social %}{% set icon = "bi-" ~ social.extra.social %}
        {% else %}
        {% set icon = social.components | last %}
        {% set icon = "bi-" ~ icon %}
        {% endif %}
        {{ shortcodes::icon(icon=icon) }}
      </a>
    </li>
    {% endfor %}
  </ul>
</footer>
{% endmacro footer %}
